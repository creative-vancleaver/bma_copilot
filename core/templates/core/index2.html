<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screen Recording Without Modal</title>
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
        }
        video {
            display: none;
        }
        button {
            margin: 10px;
        }
    </style>
</head>
<body>

    <button id="startScreenShare">Start Recording</button>
    <button id="openModal">Open Modal in New Window</button>

    <video id="screenVideo" autoplay></video>

    <script>
        let modalWindow;
        let mediaRecorder;
        let recordedChunks = [];

        document.getElementById("openModal").addEventListener("click", () => {
            if (!modalWindow || modalWindow.closed) {
                modalWindow = window.open("", "_blank", "width=300,height=200");
                modalWindow.document.write(`
                    <html>
                    <head>
                        <title>Modal Window</title>
                        <style>
                            body {
                                text-align: center;
                                font-family: Arial, sans-serif;
                                background-color: white;
                                padding: 20px;
                            }
                            button {
                                margin-top: 20px;
                            }
                        </style>
                    </head>
                    <body>
                        <h3>Popup Modal</h3>
                        <p>This will NOT be recorded.</p>
                        <button onclick="window.close()">Close</button>
                    </body>
                    </html>
                `);
            } else {
                modalWindow.focus();
            }
        });

        document.getElementById("startScreenShare").addEventListener("click", async () => {
            try {
                const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });

                const videoElement = document.getElementById("screenVideo");
                videoElement.srcObject = stream;

                recordedChunks = [];
                mediaRecorder = new MediaRecorder(stream, { mimeType: "video/webm" });

                mediaRecorder.ondataavailable = event => {
                    if (event.data.size > 0) recordedChunks.push(event.data);
                };

                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: "video/webm" });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement("a");
                    a.href = url;
                    a.download = "screen_recording_without_modal.webm";
                    document.body.appendChild(a);
                    a.click();
                    URL.revokeObjectURL(url);
                };

                mediaRecorder.start();
                setTimeout(() => mediaRecorder.stop(), 10000); // Stop after 10 seconds
            } catch (err) {
                console.error("Error accessing screen share:", err);
            }
        });

    </script>

</body>
</html>
